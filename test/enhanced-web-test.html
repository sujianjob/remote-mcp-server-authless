<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Interactive Feedback Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .iframe-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }
        iframe {
            width: 100%;
            height: 700px;
            border: none;
        }
        .code {
            background: #f1f3f4;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .feature-card {
            background: #e3f2fd;
            padding: 16px;
            border-radius: 8px;
            border-left: 4px solid #2196f3;
        }
        .feature-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: #1976d2;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ Enhanced Interactive Feedback System Test</h1>
    <p>æµ‹è¯•æ”¹è¿›åçš„Interactive Feedbackç³»ç»Ÿï¼ŒåŒ…æ‹¬åé¦ˆåˆ—è¡¨ã€AIå†…å®¹æ¸²æŸ“å’Œå¢å¼ºçš„ç”¨æˆ·ä½“éªŒã€‚</p>

    <div class="test-section">
        <h2>ğŸ¯ æ–°åŠŸèƒ½ç‰¹æ€§</h2>
        <div class="feature-grid">
            <div class="feature-card">
                <div class="feature-title">ğŸ“‹ åé¦ˆåˆ—è¡¨é¡µé¢</div>
                <p>ç»Ÿä¸€çš„å…¥å£é¡µé¢ï¼Œæ˜¾ç¤ºæ‰€æœ‰å¾…å¤„ç†çš„åé¦ˆä»»åŠ¡ï¼Œæ”¯æŒçŠ¶æ€è¿‡æ»¤å’Œå®æ—¶åˆ·æ–°ã€‚</p>
            </div>
            <div class="feature-card">
                <div class="feature-title">ğŸ¤– AIå†…å®¹æ¸²æŸ“</div>
                <p>æ”¯æŒMarkdownæ ¼å¼çš„AIåé¦ˆå†…å®¹ï¼ŒåŒ…æ‹¬ç²—ä½“ã€æ–œä½“ã€ä»£ç å—ç­‰æ ¼å¼ã€‚</p>
            </div>
            <div class="feature-card">
                <div class="feature-title">ğŸ¨ å¢å¼ºçš„UI/UX</div>
                <p>ç°ä»£åŒ–çš„ç•Œé¢è®¾è®¡ï¼Œå“åº”å¼å¸ƒå±€ï¼Œä¸»é¢˜åˆ‡æ¢ï¼Œå¤šè¯­è¨€æ”¯æŒã€‚</p>
            </div>
            <div class="feature-card">
                <div class="feature-title">ğŸ”„ å®Œæ•´çš„å·¥ä½œæµç¨‹</div>
                <p>ä»åˆ—è¡¨æŸ¥çœ‹ â†’ ç‚¹å‡»ä»»åŠ¡ â†’ æŸ¥çœ‹AIå†…å®¹ â†’ æä¾›åé¦ˆ â†’ æäº¤å®Œæˆã€‚</p>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª APIæµ‹è¯•</h2>
        <button class="test-button" onclick="createAIFeedbackSession()">åˆ›å»ºAIåé¦ˆä¼šè¯</button>
        <button class="test-button" onclick="createRegularSession()">åˆ›å»ºæ™®é€šåé¦ˆä¼šè¯</button>
        <button class="test-button" onclick="getFeedbackList()">è·å–åé¦ˆåˆ—è¡¨</button>
        <button class="test-button" onclick="testSubmitFeedback()">æµ‹è¯•æäº¤åé¦ˆ</button>
        <div id="api-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸŒ Webç•Œé¢æµ‹è¯•</h2>
        <p>æµ‹è¯•ä¸åŒçš„é¡µé¢å’Œä¸»é¢˜ï¼š</p>
        <button class="test-button" onclick="loadFeedbackList('dark', 'zh')">åé¦ˆåˆ—è¡¨ (æš—è‰²ä¸­æ–‡)</button>
        <button class="test-button" onclick="loadFeedbackList('light', 'en')">Feedback List (Light English)</button>
        <button class="test-button" onclick="loadFeedbackDetail()">åé¦ˆè¯¦æƒ…é¡µé¢</button>
        <button class="test-button" onclick="loadAIContentPage()">AIå†…å®¹é¡µé¢</button>
        
        <div class="iframe-container">
            <iframe id="test-iframe" src="about:blank"></iframe>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
        <div id="test-summary">
            <p>ç‚¹å‡»ä¸Šé¢çš„æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://127.0.0.1:8787';
        const API_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZXN0LXVzZXIiLCJ1c2VybmFtZSI6InRlc3R1c2VyIiwicm9sZXMiOlsidXNlciJdLCJpYXQiOjE3NTAwNjczMjcsImV4cCI6MTc1MDA3MDkyN30.5yNkc52U5_KDTbTljzJsd_I5RdxrztgDxC22_PJX6i4';
        
        let currentSessionId = null;
        let aiSessionId = null;

        function showResult(containerId, message, isSuccess = true) {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${isSuccess ? 'success' : 'error'}`;
            resultDiv.innerHTML = message;
            container.appendChild(resultDiv);
        }

        async function createAIFeedbackSession() {
            try {
                showResult('api-results', 'ğŸ”„ æ­£åœ¨åˆ›å»ºåŒ…å«AIå†…å®¹çš„åé¦ˆä¼šè¯...', true);
                
                const response = await fetch(`${BASE_URL}/api/feedback/create`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: "ä»£ç å®¡æŸ¥åé¦ˆ",
                        message: "è¯·å¯¹ä»¥ä¸‹ä»£ç å®ç°è¿›è¡Œè¯„ä»·å’Œå»ºè®®",
                        aiContent: "## ä»£ç åˆ†æç»“æœ\\n\\nç»è¿‡åˆ†æï¼Œæ‚¨çš„ä»£ç å®ç°æœ‰ä»¥ä¸‹**ä¼˜ç‚¹**ï¼š\\n\\n1. **ç»“æ„æ¸…æ™°**ï¼šæ¨¡å—åŒ–è®¾è®¡è‰¯å¥½\\n2. **ç±»å‹å®‰å…¨**ï¼šä½¿ç”¨äº†TypeScriptç±»å‹å®šä¹‰\\n3. **é”™è¯¯å¤„ç†**ï¼šåŒ…å«äº†å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶\\n\\n### å»ºè®®æ”¹è¿›\\n\\n- å¯ä»¥è€ƒè™‘æ·»åŠ æ›´å¤šçš„*å•å…ƒæµ‹è¯•*\\n- å»ºè®®ä½¿ç”¨`async/await`æ›¿ä»£Promiseé“¾\\n- æ€§èƒ½ä¼˜åŒ–ï¼šè€ƒè™‘ä½¿ç”¨ç¼“å­˜æœºåˆ¶\\n\\n**æ€»ä½“è¯„åˆ†ï¼š8.5/10**",
                        predefinedOptions: ["ä»£ç ç»“æ„ä¼˜ç§€", "ç±»å‹å®šä¹‰å®Œå–„", "é”™è¯¯å¤„ç†åˆ°ä½", "éœ€è¦æ›´å¤šæµ‹è¯•", "æ€§èƒ½å¯ä»¥ä¼˜åŒ–"],
                        timeout: 1800
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    aiSessionId = result.data.sessionId;
                    showResult('api-results', `
                        âœ… <strong>AIåé¦ˆä¼šè¯åˆ›å»ºæˆåŠŸï¼</strong><br>
                        Session ID: <code>${result.data.sessionId}</code><br>
                        åŒ…å«AIå†…å®¹çš„åé¦ˆé¡µé¢: <a href="${result.data.feedbackUrl}" target="_blank">æ‰“å¼€é¡µé¢</a>
                    `, true);
                } else {
                    showResult('api-results', `âŒ åˆ›å»ºå¤±è´¥: ${result.error.message}`, false);
                }
            } catch (error) {
                showResult('api-results', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, false);
            }
        }

        async function createRegularSession() {
            try {
                showResult('api-results', 'ğŸ”„ æ­£åœ¨åˆ›å»ºæ™®é€šåé¦ˆä¼šè¯...', true);
                
                const response = await fetch(`${BASE_URL}/api/feedback/create`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: "ç”¨æˆ·ä½“éªŒè°ƒç ”",
                        message: "è¯·å¯¹æˆ‘ä»¬çš„æ–°åŠŸèƒ½è¿›è¡Œè¯„ä»·ï¼Œæ‚¨çš„åé¦ˆå¯¹æˆ‘ä»¬å¾ˆé‡è¦ã€‚",
                        predefinedOptions: ["ç•Œé¢ç¾è§‚", "åŠŸèƒ½å®ç”¨", "æ“ä½œç®€å•", "å“åº”å¿«é€Ÿ", "éœ€è¦æ”¹è¿›"],
                        timeout: 1200
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    currentSessionId = result.data.sessionId;
                    showResult('api-results', `
                        âœ… <strong>æ™®é€šåé¦ˆä¼šè¯åˆ›å»ºæˆåŠŸï¼</strong><br>
                        Session ID: <code>${result.data.sessionId}</code><br>
                        åé¦ˆé¡µé¢: <a href="${result.data.feedbackUrl}" target="_blank">æ‰“å¼€é¡µé¢</a>
                    `, true);
                } else {
                    showResult('api-results', `âŒ åˆ›å»ºå¤±è´¥: ${result.error.message}`, false);
                }
            } catch (error) {
                showResult('api-results', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, false);
            }
        }

        async function getFeedbackList() {
            try {
                showResult('api-results', 'ğŸ”„ æ­£åœ¨è·å–åé¦ˆåˆ—è¡¨...', true);
                
                const response = await fetch(`${BASE_URL}/api/feedback/list?status=pending`, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    showResult('api-results', `
                        âœ… <strong>åé¦ˆåˆ—è¡¨è·å–æˆåŠŸï¼</strong><br>
                        æ€»ä»»åŠ¡æ•°: ${result.data.total}<br>
                        å¾…å¤„ç†: ${result.data.pending}<br>
                        å·²å®Œæˆ: ${result.data.completed}<br>
                        å½“å‰æ˜¾ç¤º: ${result.data.items.length} ä¸ªå¾…å¤„ç†ä»»åŠ¡
                    `, true);
                } else {
                    showResult('api-results', `âŒ è·å–å¤±è´¥: ${result.error.message}`, false);
                }
            } catch (error) {
                showResult('api-results', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, false);
            }
        }

        async function testSubmitFeedback() {
            const sessionId = currentSessionId || aiSessionId;
            if (!sessionId) {
                showResult('api-results', 'âŒ è¯·å…ˆåˆ›å»ºä¸€ä¸ªåé¦ˆä¼šè¯', false);
                return;
            }

            try {
                showResult('api-results', 'ğŸ”„ æ­£åœ¨æäº¤æµ‹è¯•åé¦ˆ...', true);
                
                const response = await fetch(`${BASE_URL}/api/feedback/${sessionId}/submit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        selectedOptions: ["ç•Œé¢ç¾è§‚", "åŠŸèƒ½å®ç”¨"],
                        freeText: "æ•´ä½“ä½“éªŒå¾ˆå¥½ï¼Œç‰¹åˆ«æ˜¯æ–°çš„åé¦ˆåˆ—è¡¨åŠŸèƒ½å¾ˆå®ç”¨ï¼AIå†…å®¹æ¸²æŸ“ä¹Ÿå¾ˆæ£’ã€‚",
                        metadata: {
                            testMode: true,
                            userAgent: navigator.userAgent,
                            timestamp: new Date().toISOString()
                        }
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    showResult('api-results', `
                        âœ… <strong>åé¦ˆæäº¤æˆåŠŸï¼</strong><br>
                        Session ID: ${result.data.sessionId}<br>
                        çŠ¶æ€: ${result.data.status}<br>
                        æäº¤æ—¶é—´: ${new Date(result.data.submittedAt).toLocaleString()}
                    `, true);
                } else {
                    showResult('api-results', `âŒ æäº¤å¤±è´¥: ${result.error.message}`, false);
                }
            } catch (error) {
                showResult('api-results', `âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, false);
            }
        }

        function loadFeedbackList(theme, lang) {
            const iframe = document.getElementById('test-iframe');
            const url = `${BASE_URL}/feedback?theme=${theme}&lang=${lang}`;
            iframe.src = url;
            
            showResult('api-results', `
                ğŸ¨ <strong>åŠ è½½åé¦ˆåˆ—è¡¨é¡µé¢</strong><br>
                ä¸»é¢˜: ${theme}<br>
                è¯­è¨€: ${lang}<br>
                URL: <a href="${url}" target="_blank">${url}</a>
            `, true);
        }

        function loadFeedbackDetail() {
            const sessionId = currentSessionId || aiSessionId;
            if (!sessionId) {
                alert('è¯·å…ˆåˆ›å»ºä¸€ä¸ªåé¦ˆä¼šè¯');
                return;
            }

            const iframe = document.getElementById('test-iframe');
            const url = `${BASE_URL}/feedback/${sessionId}?theme=dark&lang=zh`;
            iframe.src = url;
            
            showResult('api-results', `
                ğŸ“ <strong>åŠ è½½åé¦ˆè¯¦æƒ…é¡µé¢</strong><br>
                Session ID: ${sessionId}<br>
                URL: <a href="${url}" target="_blank">${url}</a>
            `, true);
        }

        function loadAIContentPage() {
            if (!aiSessionId) {
                alert('è¯·å…ˆåˆ›å»ºä¸€ä¸ªåŒ…å«AIå†…å®¹çš„åé¦ˆä¼šè¯');
                return;
            }

            const iframe = document.getElementById('test-iframe');
            const url = `${BASE_URL}/feedback/${aiSessionId}?theme=light&lang=en`;
            iframe.src = url;
            
            showResult('api-results', `
                ğŸ¤– <strong>åŠ è½½AIå†…å®¹é¡µé¢</strong><br>
                Session ID: ${aiSessionId}<br>
                ä¸»é¢˜: Light English<br>
                URL: <a href="${url}" target="_blank">${url}</a>
            `, true);
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            showResult('api-results', 'ğŸš€ Enhanced Interactive Feedbackæµ‹è¯•å·¥å…·å·²å‡†å¤‡å°±ç»ªã€‚å¼€å§‹æµ‹è¯•æ–°åŠŸèƒ½ï¼', true);
        };
    </script>
</body>
</html>
